# YouTube Notion Register API ドキュメント

## 1. APIの概要

このAPIは、指定されたYouTube動画の情報を収集し、字幕をAIで分析・要約し、その結果をNotionデータベースに登録するための一連の機能を提供します。

処理はステートフルであり、最初の `/collect` で発行される `session_id` を使って、分析から登録までの一連の操作を紐付けます。

## 2. 自動生成ドキュメント

APIの各エンドポイントに関する詳細な仕様（リクエストボディ、レスポンス、パラメータなど）は、FastAPIによって自動生成されるインタラクティブなドキュメントで確認できます。

サーバー実行中に、以下のURLにアクセスしてください。

- **Swagger UI**: [http://localhost:8000/docs](http://localhost:8000/docs)
- **ReDoc**: [http://localhost:8000/redoc](http://localhost:8000/redoc)

## 3. 主要なワークフロー

このAPIの基本的な使用方法は、以下の3ステップです。

1.  `POST /api/v1/collect`
    *   YouTubeのURLを送信し、動画情報と字幕を収集します。
    *   **リクエスト例**: `{ "youtube_url": "https://www.youtube.com/watch?v=..." }`
    *   レスポンスとして、後続の処理で必要となる `session_id` を受け取ります。

2.  `POST /api/v1/analyze`
    *   ステップ1で取得した `session_id` を送信し、サーバー側で字幕の分析・要約をAIに依頼します。
    *   **リクエスト例**: `{ "session_id": "..." }`
    *   レスポンスとして、AIによって生成されたタイトル案、要約、カテゴリなどを受け取ります。

3.  `POST /api/v1/register`
    *   `session_id` と、ユーザーによって確認・修正された最終的なデータを送信し、Notionデータベースへの登録を依頼します。
    *   **リクエスト例**: `{ "session_id": "...", "title": "最終的なタイトル", "summary": "最終的な要約", ... }`
    *   レスポンスとして、作成されたNotionページのURLを受け取ります。

## 4. エンドポイント概要

| エンドポイント                  | HTTPメソッド | 説明                                                     |
| -------------------------- | :----------: | -------------------------------------------------------- |
| `/api/v1/health`           |     GET      | サーバーの死活監視用エンドポイント。                     |
| `/api/v1/collect`          |     POST     | 動画データを収集し、処理セッションを開始する。           |
| `/api/v1/analyze`          |     POST     | 収集したデータを基にAIで分析を行う。                     |
| `/api/v1/register`         |     POST     | 分析・修正された内容をNotionに登録する。                 |
| `/api/v1/sessions/{session_id}` | GET | 指定されたセッションIDの現在の情報を取得する。 |

## 5. カスタムエラーコード

APIは、エラー発生時に以下のカスタムエラーコードを含むレスポンスを返すことがあります。

| コード | 説明                                         |
| :---: | ------------------------------------------ |
| E001  | 不正なYouTube URL                          |
| E002  | 字幕取得不可                               |
| E003  | YouTube API制限                            |
| E004  | APIレート制限超過 / Gemini API制限         |
| E005  | Notion API認証エラー                       |
| E006  | セッション期限切れ                         |
| E007  | セッションデータのファイル操作エラー       |
| E008  | 外部API障害（Notionなど）                  |
| E009  | 指定された動画が見つかりません             |
| E010  | 必須のAPIキーまたは設定が不足しています    |
